<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hive Assessment Workbench</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
        }
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-blue-800 mb-2">Hive Assessment Workbench</h1>
            <p class="text-gray-600">Simulate test scenarios to identify key Hive configuration parameters.</p>
        </header>

        <!-- Configuration & Scenario Selector -->
        <div class="bg-white p-6 rounded-xl card-shadow mb-8">
            <h2 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">1. Define Test Scenario</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Scenario Dropdown -->
                <div>
                    <label for="scenarioSelect" class="block text-sm font-medium text-gray-700 mb-1">Select Assessment Focus:</label>
                    <select id="scenarioSelect" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md transition duration-150 ease-in-out">
                        <option value="joins">Large-Table JOIN Performance</option>
                        <option value="aggregation">Complex Aggregations (GROUP BY, AVG/SUM)</option>
                        <option value="complex_types">Querying Nested JSON/Arrays</option>
                        <option value="io">High I/O Read (Full Table Scans)</option>
                        <option value="partitioning">Partition Pruning Efficiency</option>
                    </select>
                </div>

                <!-- Simulation Size Input -->
                <div>
                    <label for="recordCount" class="block text-sm font-medium text-gray-700 mb-1">Simulated Record Count (Millions):</label>
                    <input type="number" id="recordCount" value="100" min="1" class="mt-1 block w-full pl-3 pr-4 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md" />
                </div>
            </div>

            <button onclick="runAssessment()" class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:shadow-outline transition duration-150 ease-in-out transform hover:scale-[1.01]">
                Simulate Assessment
            </button>
        </div>

        <!-- Simulated Results Dashboard -->
        <div class="bg-white p-6 rounded-xl card-shadow">
            <h2 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">2. Assessment Findings & Recommended Optimizations</h2>
            
            <div id="resultsContent" class="text-gray-700">
                <p class="text-center py-8 text-gray-500">Select a scenario and click "Simulate Assessment" to see recommended Hive optimizations and test metrics.</p>
            </div>
        </div>
    </div>

    <script>
        // Data Structure for Simulated Assessment
        const assessmentData = {
            joins: {
                title: "Large-Table JOIN Performance Assessment",
                description: "Focuses on optimizing hash-join memory usage and data distribution.",
                metrics: [
                    { name: "Query Execution Time (ms)", value: 4500, target: 2000, color: 'orange' },
                    { name: "Spill to Disk (GB)", value: 2.5, target: 0.5, color: 'red' },
                    { name: "CPU Utilization (%)", value: 85, target: 95, color: 'green' }
                ],
                config: [
                    { setting: "hive.auto.convert.join=true", details: "Enables automatic conversion to map-side joins (for smaller tables)." },
                    { setting: "hive.optimize.bucketmapjoin=true", details: "Crucial for optimized joins if tables are bucketed by the join key." },
                    { setting: "hive.exec.parallel=true", details: "Allows parallel execution of dependent stages." }
                ],
                testQuery: "SELECT T1.user_id, T2.order_count FROM Transactions T1 JOIN UserActivity T2 ON T1.user_id = T2.user_id WHERE T1.country = 'USA';"
            },
            aggregation: {
                title: "Complex Aggregations Assessment",
                description: "Focuses on reducing the number of reducers and improving group-by efficiency.",
                metrics: [
                    { name: "Query Execution Time (ms)", value: 7200, target: 3500, color: 'red' },
                    { name: "Data Skew Ratio", value: 4.1, target: 1.5, color: 'red' }
                ],
                config: [
                    { setting: "hive.map.aggr=true", details: "Performs partial aggregation in the map phase to reduce data shuffle." },
                    { setting: "hive.groupby.skewindata=true", details: "Handles data skew in GROUP BY by breaking it into two phases (two MapReduce jobs)." },
                    { setting: "tez.grouping.max-size=1000000000", details: "Controls the maximum size of a grouped output in Tez." }
                ],
                testQuery: "SELECT T1.country, T1.transaction_ts, COUNT(T1.transaction_id) FROM Transactions T1 GROUP BY T1.country, T1.transaction_ts ORDER BY T1.transaction_ts DESC;"
            },
            complex_types: {
                title: "Nested Data Types Assessment (JSON/ARRAY)",
                description: "Focuses on the overhead of deserialization and explosion of complex fields.",
                metrics: [
                    { name: "Query Execution Time (ms)", value: 5800, target: 4000, color: 'orange' },
                    { name: "Deserialization Overhead (%)", value: 22, target: 10, color: 'red' }
                ],
                config: [
                    { setting: "hive.optimize.json.serde=true", details: "Ensures the most efficient JSON SerDe is being used." },
                    { setting: "hive.optimize.index.filter=true", details: "Attempts to filter data before deserializing complex types." },
                    { setting: "hive.cbo.enable=true", details: "Cost-Based Optimizer helps estimate the cost of complex operations like LATERAL VIEW." }
                ],
                testQuery: "SELECT t.user_id, i.sku, i.qty FROM Transactions t LATERAL VIEW EXPLODE(t.items_purchased) exploded_items as i WHERE i.price > 50;"
            },
            io: {
                title: "High I/O Read Assessment (Full Table Scans)",
                description: "Focuses on optimizing columnar file formats and compression.",
                metrics: [
                    { name: "Query Execution Time (ms)", value: 9100, target: 4500, color: 'red' },
                    { name: "Data Read (MB/s)", value: 150, target: 300, color: 'orange' }
                ],
                config: [
                    { setting: "hive.exec.orc.split.strategy=HYBRID", details: "Hybrid strategy to combine row-group and stripe-level filtering for ORC." },
                    { setting: "hive.exec.scratchdir=/tmp/hive_scratch", details: "Ensures scratch directories are on fast local storage (SSDs)." },
                    { setting: "tez.runtime.compress.intermediate=true", details: "Compresses intermediate data written by mappers/reducers." }
                ],
                testQuery: "SELECT COUNT(*), AVG(total_amount) FROM Transactions WHERE user_agent LIKE '%Chrome%';"
            },
            partitioning: {
                title: "Partition Pruning Efficiency Assessment",
                description: "Focuses on testing partition elimination and directory listing overhead.",
                metrics: [
                    { name: "Query Execution Time (ms)", value: 1200, target: 800, color: 'green' },
                    { name: "Partitions Scanned", value: 4, target: 1, color: 'green' }
                ],
                config: [
                    { setting: "hive.mapred.mode=strict", details: "Prevents queries that try to scan all partitions without explicit WHERE clauses." },
                    { setting: "hive.optimize.ppd=true", details: "Enables partition pruning (PPD) and predicate pushdown." },
                    { setting: "metastore.client.socket.timeout=1800", details: "Increases timeout for Metastore interaction during partition listing." }
                ],
                testQuery: "SELECT total_amount FROM Transactions WHERE country = 'UK' AND transaction_ts BETWEEN '2025-01-01' AND '2025-01-07';"
            }
        };

        function runAssessment() {
            const scenario = document.getElementById('scenarioSelect').value;
            const records = document.getElementById('recordCount').value;
            const data = assessmentData[scenario];
            const resultsDiv = document.getElementById('resultsContent');

            // --- HTML Generation ---

            let html = `
                <div class="space-y-6">
                    <h3 class="text-2xl font-bold text-indigo-700">${data.title}</h3>
                    <p class="text-md text-gray-600">${data.description}</p>
                    <p class="mt-2 text-sm text-gray-500 font-mono">Simulated on ${records} million records.</p>
                    
                    <div class="bg-indigo-50 p-4 rounded-lg">
                        <p class="font-semibold text-indigo-800 mb-2">Simulated Test Query:</p>
                        <pre class="bg-indigo-100 p-3 rounded text-sm overflow-x-auto text-indigo-900">${data.testQuery}</pre>
                    </div>

                    <!-- Metrics -->
                    <h4 class="text-lg font-semibold text-gray-800 pt-4">Simulated Performance Metrics</h4>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        ${data.metrics.map(m => `
                            <div class="bg-white p-4 border rounded-lg shadow-sm">
                                <p class="text-2xl font-bold text-${m.color}-600">${m.value} ${m.name.includes('(ms)') ? 'ms' : m.name.includes('(GB)') ? 'GB' : '%'}</p>
                                <p class="text-xs text-gray-500">${m.name}</p>
                                <p class="text-xs text-gray-400 mt-1">Target: ${m.target} ${m.name.includes('(ms)') ? 'ms' : m.name.includes('(GB)') ? 'GB' : '%'}</p>
                            </div>
                        `).join('')}
                    </div>

                    <!-- Recommended Configs -->
                    <h4 class="text-lg font-semibold text-gray-800 pt-4">Recommended Optimization Parameters to Test</h4>
                    <ul class="list-none space-y-3">
                        ${data.config.map(c => `
                            <li class="bg-green-50 p-3 rounded-lg flex items-start space-x-3">
                                <svg class="w-5 h-5 text-green-600 flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                                <div>
                                    <code class="font-mono text-sm font-semibold text-green-700 block">SET ${c.setting};</code>
                                    <span class="text-xs text-gray-600">${c.details}</span>
                                </div>
                            </li>
                        `).join('')}
                    </ul>
                </div>
            `;

            resultsDiv.innerHTML = html;
        }

        // Run default assessment on load
        document.addEventListener('DOMContentLoaded', runAssessment);
    </script>

</body>
</html>